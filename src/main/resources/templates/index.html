<!DOCTYPE html>
<html  xmlns:th="http://thymeleaf.org" >
<head>
    <title>Minha Primeira Página</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>


    <h1>Bem-vindo, <p th:text="${usuarioLogado}"></p></h1>
    <p>Esta é a minha primeira página com Spring Boot e Thymeleaf.</p>

    <h1>Lista de Clientes</h1>
    <table>
        <thead>
        <tr>
            <th>Nome</th>
            <th>Email</th>
            <th>Telefone</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="cliente : ${clientes}">

            <td th:text="${cliente.nome}"></td>
            <td th:text="${cliente.email}"></td>
            <td th:text="${cliente.telefone}"></td>

        </tr>
        </tbody>
    </table>

    <!-- TODO:Listar Clientes-->
    <h1>Cadastro de Cliente</h1>
    <form action="/clientes/novo" method="post" accept-charset="UTF-8">
        <label for="nome">nome:</label>
        <input type="text" id="nome" name="nome" required>
        <br><br>

        <label for="telefone">Telefone:</label>
        <input type="text" id="telefone" name="telefone" required>
        <br><br>

        <label for="email">Email:</label>
        <input type="text" id="email" name="email" required>
        <br><br>

        <button type="submit">Salvar</button>
    </form>

    <!--TODO: mover o cadastro de veiculo para a pagina do cliente-->
    <h1>Formulario de agendamentos</h1>
    <form action="#" th:action="@{/agendamentos/novo}" method="post">
        <label for="cliente">Cliente:</label>
        <select id="cliente" name="cliente">
            <option value="" disabled selected>Selecione um cliente</option>
            <th:block th:each="cliente : ${clientes}">
                <option th:value="${cliente.id}" th:text="${cliente.nome}"></option>
            </th:block>
        </select>

        <label for="carro">Carro:</label>
        <select id="carro" name="carro" disabled>
            <option value="" disabled selected>Selecione um carro</option>
        </select>

        <input type="datetime-local" name="datahora">

        <h3>Serviços Disponíveis</h3>
        <div id="lista-servicos">
            <th:block th:each="servico : ${servicos}">
                <div>
                    <input type="checkbox" id="servico_${servico.id}" name="servicos" th:value="${servico.id}">
                    <label th:for="servico_${servico.id}" th:text="${servico.descricao}"></label>
                </div>
            </th:block>
        </div>

        <button type="submit">Agendar</button>
    </form>

    <h1>Formulário de Veículo</h1>
    <form action="/carros/novo" method="post">

        <select id="client" name="cliente">
            <option value="" >Selecione um cliente</option>
            <th:block th:each="cliente : ${clientes}">
                <option th:value="${cliente.id}" th:text="${cliente.nome}"></option>
            </th:block>
        </select>


        <label for="placa">Placa:</label>
        <input type="text" id="placa" name="placa" required><br><br>

        <label for="modelo">Modelo:</label>
        <input type="text" id="modelo" name="modelo" required><br><br>

        <label for="cor">Cor:</label>
        <input type="text" id="cor" name="cor" required><br><br>

        <input type="submit" value="Enviar">
    </form>

    <h1>Cadastro de Serviço</h1>

    <form action="#" th:action="@{/servicos/novo}" method="post">
        <label for="descricao">Descrição:</label>
        <input type="text" id="descricao" name="descricao" required>
        <br><br>

        <label for="preco">Preço:</label>
        <input type="number" id="preco" name="preco" step="0.01" required>
        <br><br>

        <label for="duracao">Duração (em minutos):</label>
        <input type="number" id="duracao" name="duracao" required>
        <br><br>

        <button type="submit">Cadastrar Serviço</button>
    </form>

    <form action="logout" method="post">
        <input type="submit" value="Sair">
    </form>
    <script>
        $(document).ready(function() {
            $('#cliente').change(function() {
                var clienteId = $(this).val();
                if (clienteId) {
                    $.ajax({
                        url: '/carros/cliente/' + clienteId,
                        method: 'GET',
                        success: function(data) {
                            var $carroSelect = $('#carro');
                            $carroSelect.empty().append('<option value="" disabled selected>Selecione um carro</option>');
                            $.each(data, function(index, carro) {
                                $carroSelect.append('<option value="' + carro.id + '">' + carro.modelo + '</option>');
                            });
                            $carroSelect.prop('disabled', false);
                        }
                    });
                } else {
                    $('#carro').empty().append('<option value="" disabled selected>Selecione um carro</option>').prop('disabled', true);
                }
            });
            // Atualizar lista de serviços selecionados dinamicamente
            $('#servicos').change(function() {
                var selectedOptions = $(this).find('option:selected');
                var $listaServicos = $('#lista-servicos-selecionados');
                $listaServicos.empty(); // Limpar lista antes de adicionar novamente
                selectedOptions.each(function() {
                    $listaServicos.append('<li>' + $(this).text() + '</li>');
                });
            });
        });
    </script>
</body>
</html>
